local UIS = game:GetService("UserInputService")
local Run = game:GetService("RunService")
local Player = game.Players.LocalPlayer
local Tycoon = Player.PlayerTycoon.Value
local Popup = Player.PlayerGui.GUI.InputPrompt.InputPrompt
local Ores = game.Workspace.DroppedParts:FindFirstChild(Tycoon.Name)
local Autofarm = nil
local Upgraders = {
	"Candy Castle",
	"Candy Core",
	"Candy Corn Real Estate",
	"Candy Refiner",
	"Candycorn Refiner",
	"Chocolate Coater",
	"Chocolate Forest",
	"Frank'n'Cupcake",
	"Giant Pretzel",
	"Grand Wafer",
	"Gummy Refiner",
	"Hellish Bat Cookie",
	"Lollipop-inator",
	"Ore Caramelizer",
	"Pumpkin Pie Refiner",
	"Pumpkin Spice Refiner",
	"Sugar Corroder",
	"The Cookinator",
	"The Rock",
}
local Collectors = {
	["Candy Metropolis"] = 10000,
	["Candy Factory"] = 3000,
	["Candy Center"] = 500,	
}
local Mine = Tycoon:FindFirstChild("Pumpkinite Mine") or Tycoon:FindFirstChild("Super Swintite Mine") or Tycoon:FindFirstChild("Swintite Mine")
local Collect = nil
local Count = 0

for i,v in pairs(Collectors) do
	if Tycoon:FindFirstChild(i)then 
		Collect = Tycoon:FindFirstChild(i)
	end
end
if Collect then 
	Count = Collect.Model.CounterPart.CandyTracker.Background.Amount
end
function Boost(Ore)
	Ore.Anchored = true
	for i,v in pairs(Upgraders) do
		local Item = Tycoon:FindFirstChild(v)
		if Item then 
			firetouchinterest(Item.Model.Upgrade,Ore,0)
			wait(0.01)
			firetouchinterest(Item.Model.Upgrade,Ore,1)
		end
	end
	wait(.5)
	Ore.Anchored = false
	firetouchinterest(Collect.Model.Lava,Ore,0)
	firetouchinterest(Collect.Model.MiniLava,Ore,0)
end

Ores.ChildAdded:Connect(function(Ore)
	print(Ore:GetChildren())
	if Ore.Name == Mine.Name then 
		Boost(Ore)
	end
end)

UIS.InputBegan:Connect(function(Input)
	if Input.KeyCode == Enum.KeyCode.H then 
		Autofarm = not Autofarm 
	end
end)

Run.Stepped:Connect(function()
	if Autofarm then 
		if tonumber(Count.Text)>= Collectors[Collect.Name] then
			local Prompt = Collect.Model.Internal.ProximityPrompt
			Player.Character.HumanoidRootPart.CFrame = Prompt.Parent.CFrame + Vector3.new(0,5,0)
			fireproximityprompt(Prompt, 10)
		else
			local Prompt = Mine.Model.Internal.ProximityPrompt
			local Mag = (Prompt.Parent.Position-Player.Character.HumanoidRootPart.Position).Magnitude
			if Mag > 10 then 
			    Player.Character.HumanoidRootPart.Anchored = true
				Player.Character.HumanoidRootPart.CFrame = Prompt.Parent.CFrame + Vector3.new(0,5,0)
				Player.Character.HumanoidRootPart.Anchored = false
			end
			fireproximityprompt(Prompt, 10)

		end
	end
end)

game.Players.LocalPlayer.PlayerGui.GUI.InputPrompt.Absorb.Changed:connect(function(property)
	if property == "Visible" then
		if string.match(string.lower(Popup.Title.Text),"would you like to collect") then
			for i,v in pairs(getconnections(game.Players.LocalPlayer.PlayerGui.GUI.InputPrompt.InputPrompt.Yes.MouseButton1Click)) do
				v:Fire()
			end
		end
	end
end)
